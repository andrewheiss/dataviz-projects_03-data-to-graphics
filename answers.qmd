---
title: "Mapping data to graphics"
subtitle: "Exercise 3 --- PMAP 8551/4551, SEMESTER YEAR"
author: "YOUR NAME HERE"
date: "DATE GOES HERE"
date-format: "long"
format:
  html:
    toc: true
    knitr:
      opts_chunk: 
        dev: "ragg_png"
        dpi: 300
  typst:
    toc: true
    include-before-body: 
      text: |
        #show heading.where(level: 1): it => { pagebreak(weak: true); it }
  pdf:
    toc: true
  docx:
    toc: true
---

# Task 1: Session check-in

::: {.callout-tip title="Answer"}
Hopefully you wrote some interesting and muddy things!
:::


# Task 2: Lord of the Rings

```{r}
#| label: setup
#| warning: false
#| message: false

# Load libraries here
library(tidyverse)
```

## Data description and cleaning

This data contains counts of words spoken by characters of different species and geners in the *Lort of the Rings* movie trilogy. It originally comes from the *manyeyes* data blog, which no longer exists---Jenny Bryan [has a copy here](https://github.com/jennybc/lotr-tidy/tree/master/data).

There are three CSV files in `data/`---one for each film. The code below loads, restructures, and cleans the data. **You don't need to modify anything in this chunk of code---you only need to run it.**

The resulting `lotr` dataset contains the following columns:

- `Film`: The name of the film
- `Species`: The type of species (elf, hobbit, man)
- `Gender`: Female and male
- `Words`: The number of words spoken in each film, species, and gender

```{r}
#| label: load-clean-data
#| warning: false
#| message: false

# Load the separate datasets
fellowship <- read_csv("data/The_Fellowship_Of_The_Ring.csv")
tt <- read_csv("data/The_Two_Towers.csv")
rotk <- read_csv("data/The_Return_Of_The_King.csv")

# bind_rows() stacks data frames on top of each other
lotr_wide <- bind_rows(fellowship, tt, rotk) |>
  # Make the Film column a categorical variable (factor), and put it in the
  # order the categories appear (so the films are in the correct order)
  mutate(Film = fct_inorder(Film))

# Make this wide data long and tidy
lotr <- lotr_wide |>
  pivot_longer(cols = c(Female, Male), names_to = "Gender", values_to = "Words")
```


## Species

Does a certain species dominate (i.e. speak the most) the entire trilogy?

### Recreate data summary

Use `group_by()` and `summarize()` to create a data frame named `lotr_species` that looks like this:

```{r}
#| label: recreate-me-data-1
#| echo: false
#| ref.label: recreation-data-1
```

::: {.callout-tip title="Answer"}

```{r}
#| label: recreation-data-1

lotr_species <- lotr |> 
  group_by(Species) |> 
  summarize(total = sum(Words))
lotr_species
```

:::

### Recreate plot

Run the code chunk below to see a plot.

```{r fig.path="images/"}
#| label: recreate-me-1
#| echo: false
#| ref.label: recreation-plot-1
```

Use `ggplot()` and `geom_col()` in the chunk below to re-create the plot above using the `lotr_species` dataset.

::: {.callout-tip title="Answer"}

```{r}
#| label: recreation-plot-1

ggplot(lotr_species, aes(x = Species, y = total)) +
  geom_col()
```

:::

## Gender and film

Does a certain gender dominate a movie? (lolz of course it does, but still, graph it).

### Recreate data summary

Use `group_by()` and `summarize()` to create a data frame named `lotr_gender_film` that looks like this:

```{r}
#| label: recreate-me-data-2
#| echo: false
#| message: false
#| ref.label: recreation-data-2
```

::: {.callout-tip title="Answer"}

```{r}
#| label: recreation-data-2
#| message: false

lotr_gender_film <- lotr |> 
  group_by(Gender, Film) |> 
  summarize(total = sum(Words))
lotr_gender_film
```

:::

### Recreate plot

Run the code chunk below to see a plot.

```{r fig.path="images/"}
#| label: recreate-me-2
#| echo: false
#| ref.label: recreation-plot-2
#| message: false
```

Use `ggplot()` and `geom_col()` in the chunk below to re-create the plot above using the `lotr_gender_film` dataset.

::: {.callout-tip title="Answer"}

```{r}
#| label: recreation-plot-2
#| message: false

ggplot(lotr_gender_film, aes(x = Film, y = total, fill = Gender)) +
  geom_col(position = position_dodge())
```

:::

## Species and film

Does the dominant species differ across the three movies?

There's no recreation here---you have all the code you need above. Hint: you'll need to group by `Species` and `Film`.

::: {.callout-tip title="Answer"}

```{r}
#| label: species-film-plot
#| message: false

lotr_species_film <- lotr |>
  group_by(Species, Film) |>
  summarize(total = sum(Words))

ggplot(lotr_species_film, aes(x = Film, y = total, fill = Species)) +
  geom_col(position = position_dodge())
```

:::

## Species and gender and film

Create a plot that visualizes the number of words spoken by species, gender, and film simultaneously. Use the complete tidy `lotr` data frame. You don't need to create a new summarized dataset (with `group_by(Species, Gender, Film)`) because the original data already has a row for each of those (you could make a summarized dataset, but it would be identical to the full version).

You need to show `Species`, `Gender`, and `Film` at the same time, but you only have two possible aesthetics (`x` and `fill`), so you'll also need to facet by the third. Play around with different combinations (e.g. try `x = Species`, then `x = Film`) until you find one that tells the clearest story.

::: {.callout-tip title="Answer"}

```{r}
#| label: plot-gender-species-film

ggplot(lotr, aes(x = Species, y = Words, fill = Gender)) + 
  geom_col(position = position_dodge()) +
  facet_wrap(vars(Film))
```

:::

# Task 3: Extension

Copy the code for one of your plots above and paste it into the chunk below. Do some extra things to it, like changing the labels, changing the colors, adding a new geom, plotting a different variable from the dataset, filling by something that you're faceting with (or vice versa), changing the theme, or whatever. **This is your chance to play around and explore.**

::: {.callout-tip title="Answer"}

Hopefully you did something neat! Here's something I did:

```{r}
#| label: extension

ggplot(lotr_species_film, aes(x = total, y = fct_rev(Film), fill = Species)) +
  geom_col(position = position_dodge()) +
  scale_fill_manual(values = c("darkred", "darkblue", "orange")) +
  labs(
    x = "Total words",
    y = "Film",
    title = "Total words spoken across species and film",
    subtitle = "Elves rarely speak"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

:::
